const LOCAL_AQUAGRUNT_1 = 1
const LOCAL_AQUAGRUNT_2 = 2
const LOCAL_AQUAGRUNT_3 = 3
const LOCAL_AQUAGRUNT_4 = 13
const LOCAL_AQUAGRUNT_5 = 14
const LOCAL_AQUAGRUNT_6 = 15
const LOCAL_AQUAGRUNT_WORKING_1 = 16
const LOCAL_AQUAGRUNT_WORKING_2 = 17
const LOCAL_AQUAGRUNT_WORKING_3 = 18
const LOCAL_AQUA_ADMIN = 19
const LOCAL_ROCK_SMASH_MACHINE = 20

mapscripts Route203_Cave_MapScripts {
    MAP_SCRIPT_ON_TRANSITION: Route203_Cave_OnTransition
}

script Route203_Cave_OnTransition {
    if(!flag(FLAG_AQUA_LEFT_ROUTE_203_CAVE))
    {        
        setflag(FLAG_HIDE_ROCK_SMASH_MACHINE)
        removeobject(LOCAL_ROCK_SMASH_MACHINE)
    }
    elif(flag(FLAG_AQUA_LEFT_ROUTE_203_CAVE) && !flag(FLAG_PLAYER_CAN_USE_ROCK_SMASH))
    {
        clearflag(FLAG_HIDE_ROCK_SMASH_MACHINE)
        addobject(LOCAL_ROCK_SMASH_MACHINE)
    }
    end
}

script Route203_Cave_EventScript_NpcRockSmash {
    random(100)
    if(!flag(FLAG_AQUA_LEFT_ROUTE_203_CAVE) && var(VAR_RESULT) < 50)
    {
        playse(SE_M_ROCK_THROW)
    }    
}

script Route203_Cave_EventScript_AdminFight {
    lock
    playbgm(MUS_ENCOUNTER_AQUA, FALSE)
    playse(SE_PIN)
    applymovement(LOCAL_AQUA_ADMIN, Common_Movement_ExclamationMark)
    waitmovement(0)
    applymovement(LOCAL_AQUA_ADMIN, Common_Movement_Delay48)
    waitmovement(0)
    applymovement(LOCAL_AQUA_ADMIN, Route203_Cave_Movement_AquaAdmin)
    waitmovement(0)
    msgbox(Route203_Cave_Text_AquaAdmin_PreBattle)
    waitmessage
    closemessage
    trainerbattle_no_intro(TRAINER_AQUA_ADMIN_ROUTE203_CAVE, Route203_Cave_Text_AquaAdmin_Defeat)

    msgbox(Route203_Cave_Text_AquaAdmin_PostBattle)
    waitmessage
    closemessage

    fadescreen(FADE_TO_BLACK)
    playse(SE_EXIT)
    waitse
    removeobject(LOCAL_AQUAGRUNT_1)
    removeobject(LOCAL_AQUAGRUNT_2)
    removeobject(LOCAL_AQUAGRUNT_3)
    removeobject(LOCAL_AQUAGRUNT_4)
    removeobject(LOCAL_AQUAGRUNT_5)
    removeobject(LOCAL_AQUAGRUNT_6)
    removeobject(LOCAL_AQUAGRUNT_WORKING_1)
    removeobject(LOCAL_AQUAGRUNT_WORKING_2)
    removeobject(LOCAL_AQUAGRUNT_WORKING_3)
    removeobject(LOCAL_AQUA_ADMIN)
    setflag(FLAG_AQUA_LEFT_ROUTE_203_CAVE)
    setvar(VAR_ROUTE203_CAVE_STATE, 1)
    setvar(VAR_LEVEL_CAP, 40)
    call(EventScript_Increase_LevelCap)
    clearflag(FLAG_HIDE_ROCK_SMASH_MACHINE)
    addobject(LOCAL_ROCK_SMASH_MACHINE)
    fadescreen(FADE_FROM_BLACK)
    
    release
    end
}

script EventScript_Increase_LevelCap {
    playfanfare(MUS_OBTAIN_BADGE)
    message(format("Your ANCIENT PLATE shines with new power!"))
    waitfanfare
    closemessage
    return
}

script Route203_Cave_EventScript_RockSmashMachine {
    lock
    removeobject(LOCAL_ROCK_SMASH_MACHINE)
    setflag(FLAG_ITEM_ROCK_SMASH_MACHINE)
    setflag(FLAG_PLAYER_CAN_USE_ROCK_SMASH)
    playfanfare(MUS_OBTAIN_ITEM)
    giveitem(ITEM_MACHINE_ROCK_SMASH)
    waitfanfare
    waitmessage
    closemessage
    release
    end
}

script Route203_Cave_EventScript_AquaGrunt_Working {
    msgbox(Route203_Cave_Text_AquaGrunt_Working, MSGBOX_SIGN)
}

script Route203_Cave_EventScript_AquaGrunt_1 {
    trainerbattle_single(TRAINER_AQUA_GRUNT_ROUTE203_CAVE_1, Route203_Cave_Text_AquaGrunt1_Intro, Route203_Cave_Text_AquaGrunt1_Defeat)
    msgbox(Route203_Cave_Text_AquaGrunt1_PostBattle, MSGBOX_AUTOCLOSE)
}

script Route203_Cave_EventScript_AquaGrunt_2 {
    trainerbattle_single(TRAINER_AQUA_GRUNT_ROUTE203_CAVE_2, Route203_Cave_Text_AquaGrunt2_Intro, Route203_Cave_Text_AquaGrunt2_Defeat)
    msgbox(Route203_Cave_Text_AquaGrunt2_PostBattle, MSGBOX_AUTOCLOSE)
}

script Route203_Cave_EventScript_AquaGrunt_3 {
    trainerbattle_single(TRAINER_AQUA_GRUNT_ROUTE203_CAVE_3, Route203_Cave_Text_AquaGrunt3_Intro, Route203_Cave_Text_AquaGrunt3_Defeat)
    msgbox(Route203_Cave_Text_AquaGrunt3_PostBattle, MSGBOX_AUTOCLOSE)
}

script Route203_Cave_EventScript_AquaGrunt_4 {
    trainerbattle_single(TRAINER_AQUA_GRUNT_ROUTE203_CAVE_4, Route203_Cave_Text_AquaGrunt4_Intro, Route203_Cave_Text_AquaGrunt4_Defeat)
    msgbox(Route203_Cave_Text_AquaGrunt4_PostBattle, MSGBOX_AUTOCLOSE)
}

script Route203_Cave_EventScript_AquaGrunt_5 {
    trainerbattle_single(TRAINER_AQUA_GRUNT_ROUTE203_CAVE_5, Route203_Cave_Text_AquaGrunt5_Intro, Route203_Cave_Text_AquaGrunt5_Defeat)
    msgbox(Route203_Cave_Text_AquaGrunt5_PostBattle, MSGBOX_AUTOCLOSE)
}

script Route203_Cave_EventScript_AquaGrunt_6 {
    trainerbattle_single(TRAINER_AQUA_GRUNT_ROUTE203_CAVE_6, Route203_Cave_Text_AquaGrunt6_Intro, Route203_Cave_Text_AquaGrunt6_Defeat)
    msgbox(Route203_Cave_Text_AquaGrunt6_PostBattle, MSGBOX_AUTOCLOSE)
}

text Route203_Cave_Text_AquaGrunt1_Intro {
    format("You’re not getting past us! Team Aqua rules this cave, and we’ll show you why!")
}

text Route203_Cave_Text_AquaGrunt1_Defeat {
    format("No... how could I lose in our own hideout?")
}

text Route203_Cave_Text_AquaGrunt1_PostBattle {
    format("You got lucky this time, but Team Aqua won’t let this slide!")
}

text Route203_Cave_Text_AquaGrunt2_Intro {
    format("Intruders aren’t welcome here! Prepare to face the wrath of Team Aqua!")
}

text Route203_Cave_Text_AquaGrunt2_Defeat {
    format("I can’t believe I was defeated...")
}

text Route203_Cave_Text_AquaGrunt2_PostBattle {
    format("We’ll regroup and come back stronger. You won’t stand a chance next time!")
}

text Route203_Cave_Text_AquaGrunt3_Intro {
    format("You’ve made it this far, but you won’t get any further! Team Aqua will see to that!")
}

text Route203_Cave_Text_AquaGrunt3_Defeat {
    format("Defeated... how could this happen?")
}

text Route203_Cave_Text_AquaGrunt3_PostBattle {
    format("You may have won this battle, but Team Aqua’s mission isn’t over yet!")
}

text Route203_Cave_Text_AquaGrunt4_Intro {
    format("You’re up against the best of Team Aqua! Let’s see if you can handle it!")
}

text Route203_Cave_Text_AquaGrunt4_Defeat {
    format("No way... I was supposed to stop you!")
}

text Route203_Cave_Text_AquaGrunt4_PostBattle {
    format("Don’t get too comfortable. Team Aqua will strike back with even more force!")
}

text Route203_Cave_Text_AquaGrunt5_Intro {
    format("You’ve come far, but this is where your journey ends! Team Aqua will crush you!")
}

text Route203_Cave_Text_AquaGrunt5_Defeat {
    format("I can’t believe it... defeated in our own cave...")
}

text Route203_Cave_Text_AquaGrunt5_PostBattle {
    format("This isn’t over! We’ll return with a vengeance!")
}

text Route203_Cave_Text_AquaGrunt6_Intro {
    format("You’re no match for the power of Team Aqua! Prepare to be washed away!")
}

text Route203_Cave_Text_AquaGrunt6_Defeat {
    format("Swept away... by a mere trainer...")
}

text Route203_Cave_Text_AquaGrunt6_PostBattle {
    format("You got the better of me this time, but Team Aqua won’t be so easily defeated again!")
}

text Route203_Cave_Text_AquaGrunt_Working {
    format("Can't you see that I'm working.")
}
text Route203_Cave_Text_AquaAdmin_PreBattle {
    format("How has an intruder gotten this far? What are these useless grunts doing?\p It doesn't matter. I'll stop you personally.")
}

text Route203_Cave_Text_AquaAdmin_Defeat {
    format("How could this happen... I was supposed to be second to none other than the boss.")
}

text Route203_Cave_Text_AquaAdmin_PostBattle {
    format("Post")
}

text Route203_Cave_Text_RockSmashMachine {
    format("Obtained ROCK SMASH MACHINE!")
}

movement Route203_Cave_Movement_AquaAdmin {
    walk_right
    walk_up * 2
}